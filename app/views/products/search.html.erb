<p><%= link_to 'Voltar', root_path %></p>

<%= form_with url: search_products_path, method: :get, local: true do |f| %>
  <%= f.label :q, 'Busca de produtos' %>
  <%= f.text_field :q %>
  <%= f.submit 'Buscar' %>
<% end %>

<br>Filtrar por categoria:<br>
|<% ProductCategory.all.each do |categoria| %>
  <%= link_to categoria.name,
      search_products_path(q: params[:q], cat: categoria.id) %> |
<% end %>
  <%= link_to 'Todas', search_products_path(q: params[:q]) %> |

<% if not params[:q].blank? %>
  <div>
    <p>Buscando por:</p>
    <dd><span style="font-weight:bold;color:red"><%= params[:q] %></span><dd>
  </div>
  <p><%= "Em: #{ProductCategory.find(params[:cat]).name}" if not params[:cat].blank? %></p>
<% end %>

<% if not @products.empty? %>

  <h3>Resultados da Busca</h3>

  <% @products.reverse.each do |product| %>
    <dl>
      <dt><%= link_to product.name, product_path(product) %></dt>
      <dd><%= product.seller_name[0,50] %></dd>
      <dd><%= product.collaborator.sector[0,50] %></dd>
      <%= link_to(image_tag(product.photos.empty? ? 'default_product.png' :
                                                    product.photos.first.variant(resize: '100x200').processed),
                                                    product_path(product)) %>
      <dd style="color:green"><%= number_to_currency(product.sale_price) %></dd>
      <%= product.description[0,50] %><%= "..." if product.description.size > 50 %>
    </dl>
  <% end %>

<% else %>

  <p><b>Nenhum produto encontrado.</b></p>

<% end %>
